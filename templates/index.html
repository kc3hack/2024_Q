<!DOCTYPE html>
<html lang="ja">
  <head>
    <link rel="stylesheet" href="page3.css" />
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSSの読み込み -->

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
    <title>どけち掲示板</title>
    <style>
      #map {
        font-size: small;
        height: 500px;
      }
      .place {
        margin: 10px;
        padding: 4px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .place p {
        margin: 8px;
      }
      @media (max-width: 600px) {
        h1 {
          font-size: 1.2em;
        }
        #search-input,
        button {
          padding: 12px;
          font-size: 0.9em;
        }
      }
    </style>
    <!-- jQuery,Popper.js,Bootstrap JSの順番で読み込む-->
    <!-- jQueryの読み込み -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <!-- Popper.jsの読み込み -->
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>
    <!-- Bootstrapのjsの読み込み -->
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
      integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
      crossorigin="anonymous"
    ></script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyATFKf-BmfXyh2H_QSjwXSLJZiAwp0cezw&language=ja&callback=initMap"
    ></script>
    <script>
      let map;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 34.7024, lng: 135.4959 },
          zoom: 15,
        });

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };
              map.setCenter(pos);

              fetch(`/api/near_store?lat=${pos.lat}&lng=${pos.lng}`)
                .then((response) => response.json())
                .then((data) => {
                  data.forEach((store) => {
                    // マーカーの作成
                    console.log(store);
                    let marker = new google.maps.Marker({
                      position: {
                        lat: parseFloat(store[2]),
                        lng: parseFloat(store[3]),
                      },
                      map: map,
                      title: store[1],
                    });
                    // HTML要素を動的に生成してページに追加
                    const card = document.createElement("div");
                    card.className = "card mx-auto";
                    card.style = "width: 40rem; margin-top: 20px;";
                    card.innerHTML = `
                                <div class="card-body">
                                    <h5 class="card-title">${store[0][1]}</h5>
                                    <h6 class="card-subtitle mb-2 text-body-secondary">${Math.round(store[1]*100)/100} km</h6> <!-- 仮に店舗距離をstoreの6番目の要素としています -->
                                </div>
                                &nbsp;
                            `;
                    document.body.appendChild(card); // または特定の要素に追加
                  });
                });
            },
            () => {
              console.log("Geolocation service failed.");
            }
          );
        } else {
          console.log("Browser doesn't support Geolocation.");
        }
      }

      function handleLocationError(browserHasGeolocation, pos) {
        alert(
          browserHasGeolocation
            ? "Error: The Geolocation service failed."
            : "Error: Your browser doesn't support geolocation."
        );
      }
    </script>
  </head>
  <body>
    <!-- ナビゲーションメニュー -->
    <nav
    class="navbar navbar-expand-lg navbar-light text-dark bg-dark"
    id="home"
  >
    <a class="navbar-brand text-white" href="/">ドケチ掲示板</a>
    <button
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        
        <li class="nav-item">
          <a class="nav-link text-white" href="/post/index">投稿</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="/user/{{my_user}}">アカウント</a>
        </li>
      </ul>
    </div>
  </nav>
    <main>
      <div id="map"></div>
    </main>

    &nbsp;
    <div class="col-md-6">
      <div class="input-group">
        <span class="input-group-text" id="basic-addon1">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-search"
            viewBox="0 0 16 16"
          >
            <path
              d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"
            />
          </svg>
        </span>
        <input
          type="text"
          class="form-control"
          placeholder="条件を指定して検索"
          aria-label="Input group example"
          aria-describedby="basic-addon1"
        />
      </div>
    </div>
    <div class="form-group">
      <label for="textarea">メモ:</label>
      <textarea id="textarea" class="form-control"></textarea>
    </div>
    <p>付近で投稿がある店舗一覧を表示</p>

    <!-- フッター -->
    <div id="footerWrap">
      <div id="footer">
        <footer class="bg-dark text-center fixed-bottom">
          <div class="container">
            <p class="my-0 text-white py-3">ドケチ掲示板</p>
          </div>
        </footer>
      </div>
    </div>
  </body>
</html>
